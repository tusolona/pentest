#!/bin/bash

##########################################################################################################################
###This code has been written by Tendai Tuso, Chief Executive Officer of Tusolona Inc #####################################
### This Code will scan a given IP Address for open ports and vulnerabilities using nmap #################################
### After the ports are found it will further scan for  existing and hidden web ojects using dirb, nikto, and gobuster ###
### It will look for and shares available on the provide IP address using smbclient ######################################
##########################################################################################################################


# 2 arguments required and the first should be a valid IP address
if [ $# == 2 ] && [[ ${1} =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]];
then

`mkdir "./${2}" 2>/dev/null`

baseDir="./${2}"
echo $baseDir

# Scan the give IP address with nmap and create grepable and normal text files
nmap -sC -sV -A -O -v -p 1-65535 -T4 -oG $baseDir/Gnmap.txt -oN $baseDir/Nnmap.txt ${1} 


grepableNmap=$baseDir/Gnmap.txt
NormalNmap=$baseDir/Nnmap.txt



#from nmap results if port 80 is open scan with dirb, nikto and gobuster
if [ "`grep -c "80/open" $grepableNmap`" -gt 0 ] 
then 

echo "Port 80 is open"

# xterm -e dirb http://${1} -o $baseDir/${1}/dirb.txt &

#Open these utilities using another terminal and run in the background
xterm -e dirb http://${1} /usr/share/wordlists/dirb/big.txt -o $baseDir/dirb.txt 2>/dev/null & 
xterm -e nikto2 -h http://${1} -o $baseDir/nikto.txt 2>/dev/null & 
xterm -e gobuster dir -w /usr/share/dirbuster/wordlists/directory-list-2.3-medium.tx -e -t 20 -o $baseDir/gobuster.txt -u http://${1} 2>/dev/null &
xterm -e dirsearch -u http://${1} -w /usr/share/SecLists/Discovery/Web-Content/raft-large-words.txt -e php,txt,html --full-url --plain-text-report $baseDir/dsearch.txt 2>/dev/null &

fi

# Port 445 is open  scan with smbclient

if [ "`grep -c "445/open" $grepableNmap`" -gt 0 ] 
then 

echo "Port 445 is open"
xterm -e enum4linux -a ${1} >> $baseDir/enum.txt 2>/dev/null  &
# open another terminal client and dont close after completition
xterm -hold -e smbclient -L ${1} 2>/dev/null &

fi

else 
echo "Please enter a valid IP address as argument"
fi



